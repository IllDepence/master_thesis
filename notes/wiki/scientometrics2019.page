### analysis

##### citation marker surrounding patterns

* use context export (`items_all_` file)
    * save `<cited doc id>|<patt>` in CSV ✔
        * group by cited doc
        * cluster docs by (most common) pattern
        * look at diversity of patts in much cited docs
        * ...
    * save `<cited doc id>|<noun phrase preceding marker>` in CSV
        * group by NP 
        * analyze how predictive NP for cited doc is

**verification of manual sample count of cit. contexts referencing a specific part of the cited document** (cs 5, math 17, phys 4, other 7)
```
(highest in conditional probability from sentence_end_patt_comparison.txt)

NNP¦CD¦IN¦<EOS>     0.995       - The implication FORMULA is a particular case of
                                  J. Hagler's Theorem 1 of [].
                                  (1211.1719)
                                - We follow the strategy of Lemma 6 in [].
                                  (1708.09712)
                                - ... with higher ranks (cf. Definition 3.1 in []).
                                  (1204.6548)

$ cat context_patts_all_2018.csv | grep 'NNP¦CD¦IN¦\[]¦' > context_patts_specific_part_in_cited.csv
$ wc -l context_patts_specific_part_in_cited.csv
251123
$ cat context_patts_all_2018.csv | grep '\[]¦NNP¦CD' >> context_patts_specific_part_in_cited.csv
$ wc -l context_patts_specific_part_in_cited.csv
365299   (+114176)

fos by citing doc:
[['Mathematics', 298009], ['Physics', 30593], ['Computer science', 9123], ['Economics', 2974], ['Biology', 750], ['Chemistry', 685],
['Engineering', 293], ['Materials science', 235], ['Geology', 177], ['Medicine', 70], ['Psychology', 51], ['Business', 35], ['Geography', 23],
['Art', 19], ['Environmental science', 15], ['Political science', 9], ['Sociology', 9], ['Philosophy', 2], ['History', 1]]]

fos by cited doc:
[['Mathematics', 313651], ['Physics', 31087], ['Computer science', 12179], ['Economics', 2654], ['Biology', 1065], ['Chemistry', 859],
['Engineering', 641], ['Materials science', 389], ['Geology', 323], ['Psychology', 178], ['Philosophy', 169], ['Geography', 148],
['Art', 130], ['Medicine', 129], ['Business', 105], ['Sociology', 74], ['History', 73], ['Political science', 45], ['Environmental science', 27]]

fos by citation pair:
[['Mathematics->Mathematics', 281226], ['Physics->Physics', 23301], ['Mathematics->Computer science', 7204], ['Physics->Mathematics', 6062],
['Mathematics->Physics', 4991], ['Computer science->Mathematics', 4386], ['Computer science->Computer science', 4095], ['Economics->Mathematics', 1828],
['Mathematics->Economics', 1438], ['Economics->Economics', 1013], ['Mathematics->Biology', 458], ['Mathematics->Engineering', 387],
['Physics->Chemistry', 319], ['Chemistry->Physics', 311], ['Biology->Mathematics', 300], ['Biology->Biology', 280], ['Physics->Computer science', 253],
['Mathematics->Chemistry', 228], ['Chemistry->Chemistry', 170], ['Physics->Materials science', 162], ['Mathematics->Philosophy', 158],
['Engineering->Mathematics', 150], ['Physics->Geology', 147], 
```

##### missing links

```
all links:     15,846,351
matching_links: 9,882,069
    -> 62% of unarXive links found in MAG
    -> unarXive has 60% more (160%) citation interlinkgs
        -> are they correct and therefore missing in the MAG?


$ wc -l missing_links.txt 
    5964282 missing_links.txt

>>> SAMPLE GENERATION <<<
$ cat missing_links.txt | shuf | head -n 300 > missing_links_sample.txt
```

```
eval:

--- unarXive only ---

total: 150

general indicator of quality of "not in MAG" subset of links:
  valid: 146 (0.97)
  invalid: 4 (0.03)

indicators for "we have X, which is missing in MAG:"
  valid missing Feb 2019: 146 verified -> ~5805234.48
  valid missing Aug 2019: 115 verified -> ~4572616.20

misc
  papers w/ 0 references in MAG: 53 (0.35)

--- MAG only ---

total: 150

general indicator of quality of "not in unarXive" subset of links:
  valid: 142 (0.95)
  invalid: 8 (0.05)

- - - - - -

stats mc statsface

unarXive       lower    upper
  Wilson(95)   0.9334   0.9896
  Wilson(99)   0.9145   0.9920
  Jeffreys(95) 0.9379   0.9909
  Jeffreys(99) 0.9235   0.9942

MAG
  Wilson(95)   0.8983   0.9727
  Wilson(99)   0.8778   0.9777
  Jeffreys(95) 0.9019   0.9745
  Jeffreys(99) 0.8850   0.9807
```

for all 994,351 where a citing MAG ID is available:

* combined number of cited docs
    * 5,918,128 only in unarXive
    * 9,829,797 in both
    * 10,457,909 only in MAG

* number of cited docs where
    * unarXive has more cited docs: 401,046 (←those have an average (total) number of 17.46 cited docs)
    * MAG has more cited docs: 545,048 (←these have an average (total) number of 34.28 cited docs)
     * only MAG *additional* references: 241,617
     * only unarXive has *additional* references: 265,591
     * only MAG has references *at all*: 0
     * only unarXive has references *at all*: 215,291

##### MAG citation context cleanliness

```
select count(*) from papercitationcontexts where length(citationcontext) < 25;  -> 6160945      (/209606017 = 2,9%)
```
```
MAG19=> select count(*) from papercitationcontexts where substring(citationcontext from 1 for 1) = '[' or substring(citationcontext from 1 for 1) = '(' or substring(citationcontext from 1 for 1) = ',' or substring(citationcontext from 1 for 1) = ';';
  count   
----------
 15905521  -> 7.5%
```
```
select count(*) from papercitationcontexts where substring(citationcontext from 1 for 1) = lower(substring(citationcontext from 1 for 1));  -> 53928293     (/209606017= 26%)  <- lower case or non letter
select count(*) from papercitationcontexts where substring(citationcontext from 1 for 1) = upper(substring(citationcontext from 1 for 1));  -> 183538158    (/209606017 = 88%)  <- upper case or non letter
(53928293+183538158)-209606017 = 27860434 (13%) non letter
(53928293-27860434)/209606017 = 12% lower case
```

##### inflow

TODO: add notes

##### sankey numbers

* all 15,954,664
* citing: phys 9,300,576 / math 3,426,117 / cs 2,526,656 / other 701,315
* cited: phys 7,827,072 / math 5,062,033 / cs 1,876,401 / other 1,189,158
* pairs:
    * phys→phys 7,543,495
    * phys→math 967,263
    * phys→cs 157,338
    * math→phys 177,502
    * math→math 2,947,360
    * math→cs  173,168
    * cs→phys 51,942
    * cs→math 847,932
    * cs→cs 1,402,081

### misc

##### additional/better MAG noise showcase

* ~~MAG ID `1510812367` `Schwerkraft und Weltall : Grundlagen der theoretischen Kosmologie` by `Pascual Jordan` from `1952` → cited by 18 (btw. Google Scholar lists 2 versions (probably duplicates) cited 662 and 41 times)~~
* ~~MAG ID `565296403` `Pascual Jordan: Schwerkraft und Weltall, Vieweg and Sohn, Braunschweig(1952), VII+207p. 1,680円` by `小太郎 富山` (Tomiyama, Kotaro) from `1960` → cited by 0~~ (← would not have been matched in the first place b/c title does not appear in bibitems like this)

* MAG ID `2167727518`　`Observation of a new boson at a mass of 125 GeV with the CMS experiment at the LHC`　cited 17,707 times, 112 reference items
* MAG ID `2763160969`　`Observation of a new boson at a mass of 125 GeV with the CMS experiment at the LHC`　cited 0 times, 0 reference items
    * most likely caused by single listed web source [https://dspace.mit.edu/handle/1721.1/91933](https://dspace.mit.edu/handle/1721.1/91933) that only lists MIT authors (listings of authors by institution at end of paper, MIT on page 58) (→MAG mechanism assumes different paper b/c different authors→rogue duplicate)

##### new export script

* command `python3 ~/arxiv_v2.1/code/extract_contexts.py ~/arxiv_v2.1/papers/ -f items_NAU_all_sentencefix_wargparse.csv -b sqlite:////home/saiert/arxiv_v2.1.1_refs.db`
* took 115 hours for a complete export

##### notes

* [Microsoft Academic automatic document searches: Accuracy for journal articles and suitability for citation analysis](https://www.sciencedirect.com/science/article/abs/pii/S1751157717303346) compare MAG and Scopus citation counts by Spearman correlation